server {
    listen 80;
    server_name www.anjuke.com .anjuke.com;
    proxy_next_upstream http_502;

    set $if_spider 1;
    if ($cookie_isp ~ "true") {
        set $if_spider 0;
    }

    if ($remote_addr ~* ^180\.153\.227\.) {
       return 403;
    }

    if ($http_user_agent ~ must-revalidate) {
        return 403;
    }

    location /st.js {
        return 404;
    }

    location / {
        if ($cookie_beta_3w ~ "1") {
            proxy_pass http://user-zu-jinpu;
        }

        proxy_pass http://anjuke-v2-backend/;
    }


    location = / {
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Spider $if_spider;

        if ($host ~* ".*\-s\.anjuke\.com$") {
            proxy_pass http://anjuke-v2-backend;
            break;
        }

        # if ($host = "shanghai.anjuke.com") {
        #    proxy_pass http://anjuke-v2-backend;
        #    break;
        # }

        if ($host !~* "store[0-9]+\.anjuke\.com") {
	        proxy_pass http://10.10.3.39:8080;
        }
        proxy_pass http://anjuke-v2-backend/;
    }

    location /tycoon {
        recursive_error_pages on;
        error_page 555 = @tycoon_fast;
        limit_req  zone=tycoon_slow burst=1;

        if ($cookie_beta_3w ~ "1") {
            proxy_pass http://user-zu-jinpu;
        }

        if ($tycoon = 0) {
            return 555;
        }

        proxy_pass http://anjuke-v2-backend;
    }

    location @tycoon_fast {
        limit_req  zone=tycoon_fast burst=10;
        proxy_pass http://anjuke-v2-backend;
    }

    location /sale {
	    proxy_pass http://anjuke-sale/sale;
    }
    location /sales {
        proxy_pass http://anjuke-v2-backend/sales;
    }

    location /v2/prop/view {
        rewrite ^/v2/(.*)$ http://$http_host/$1 permanent;
    }

    set $propview_backend '10.10.3.28:8080';
    #set $propview_backend '10.10.3.9:8080';

    if ($host ~ "(shanghai|beijing).anjuke.com") {
        set $propview_backend '10.10.3.60:8080';
    }

    location /prop/view/ {
        limit_req   zone=one  burst=5;
        proxy_pass http://anjuke-prop-view/prop/view/;
        #proxy_pass http://$propview_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Spider $if_spider;
    }

    location  /prop/rent/ {
        proxy_pass http://anjuke-prop-view/prop/rent/;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Spider $if_spider;
    }

    location /prop/viewyz/ {
	    proxy_pass http://anjuke-prop-view/prop/viewyz/;
        proxy_temp_path /home/www/tmp/v2/temp;
    }

    location /propview.gif {
        proxy_pass http://10.10.3.61:80;
    }

    location ~ ^/propview_.*\.gif$ {
        empty_gif;
    }

    location = /soj.gif {
        empty_gif;
    }

    location = /googlecc362a8585e56242.html {
        root /home/www;
    }

    location /apixml/sougouxml/ {
        proxy_pass http://anjuke-v1-backend/apixml/sougouxml/;
    }

    location /apixml/ {
        proxy_pass http://anjuke-v1-backend/apixml/;
    }

    location /7dscan.html {
        root /data1/www;
    }

    location /baidu_verify_7jCylJvmLx.html {
        root /data1/www;
    }

    location ~* /(zu|xzl|sp|jp)/ {
        proxy_pass http://user-zu-jinpu;
    }

}

server {
    listen 80;
    server_name upd2.anjuke.com;
    client_max_body_size 20m;

    location / {
        proxy_set_header Host 'upd1.ajkimg.com';
        proxy_pass http://180.153.87.54:80;
    }
}

server {
    listen 80;
    server_name notify.anjuke.com;
    keepalive_timeout 1200;
    proxy_connect_timeout 1200; 
    proxy_read_timeout 1200;
    proxy_send_timeout 1200;

    location /im/ {
        proxy_pass http://10.10.3.61:9000/;
    }

    location / {
        proxy_pass http://10.10.3.61:4000/;
    }
}

server {
    listen 80;
    server_name .zu.anjuke.com;

    location / {
        if ($http_user_agent ~ "sohufocus" ) {
               return 403;
        }
        proxy_pass http://user-zu/;
    }
}

server {
    listen 80;
    server_name .sp.anjuke.com .xzl.anjuke.com;

    location / {
        proxy_pass http://user-jinpu/;
    }
}

server {
    listen 80;
    server_name fx.anjuke.com;

    location / {
        if ($cookie_beta_auth_token ~ "app10-023") {
            proxy_pass http://kfs-beta-php;
        }
        proxy_pass http://kfs-site-php;
    }
}

server {
    listen 80;
    server_name cms.anjuke.com;

    location /broker/operating/exportmobile {
        proxy_pass http://10.10.6.186:8080; #xapp10-031
    }
    location / {
        proxy_pass http://cms;
    }
}

server {
    listen 80;
    server_name include.cms.anjuke.com;
    location / {
        proxy_pass http://cms;
    }
}

server {
    listen 80;
    server_name topic.anjuke.com;
    location / {
        proxy_pass http://anjuke-v2-backend/;
    }
}

server {
    listen 80;
    server_name .app.anjuke.com;
    location / {
        proxy_pass http://10.10.3.212:80;
    }
}

server {
    listen 80;
    server_name i.anjuke.com;

    location / {
        proxy_pass http://i-app;
    }
}
